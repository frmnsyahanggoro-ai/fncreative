<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Redirect</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root { color-scheme: dark; }
    body{
      margin:0; min-height:100vh; display:grid; place-items:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#0b1020; color:#fff;
    }
    .card{
      width:min(560px, 92vw);
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      border-radius:16px;
      padding:20px;
      box-shadow:0 12px 30px rgba(0,0,0,.35);
    }
    h1{font-size:18px;margin:0 0 8px;}
    p{margin:0 0 12px;opacity:.9;line-height:1.5;}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;}
    a,button{
      border:0; cursor:pointer; text-decoration:none;
      padding:10px 14px; border-radius:12px; font-weight:700;
      background:#4f7cff; color:#fff;
      display:inline-flex; align-items:center; gap:8px;
    }
    a.secondary,button.secondary{
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      color:#fff;
      font-weight:600;
    }
    code{
      display:block;
      background:rgba(0,0,0,.25);
      padding:10px 12px;
      border-radius:12px;
      overflow:auto;
      font-size:12px;
    }
    .small{font-size:12px;opacity:.75;margin-top:10px;}
    .dot{width:10px;height:10px;border-radius:999px;background:#22c55e;display:inline-block}
    .warn{background:#f59e0b}
  </style>
</head>

<body>
  <div class="card">
    <h1>Redirect</h1>
    <p id="status"><span class="dot"></span> Menyiapkan…</p>

    <p class="small">Smartlink tujuan:</p>
    <code id="smart">-</code>

    <p class="small">Deep link (Android/GMALite):</p>
    <code id="deep">-</code>

    <div class="btns">
      <a id="openApp" href="#">Buka GMALite (Android)</a>
      <a id="openWeb" class="secondary" href="#" target="_blank" rel="noopener">Buka via Browser</a>
      <button id="copy" class="secondary" type="button">Salin Link</button>
    </div>

    <div class="small" id="hint"></div>
  </div>

<script>
(() => {
  // ====== KONFIG ======
  const SMARTLINK = "https://fncreative.short.gy/OCbnE0";
  const AUTO_OPEN_DELAY_MS = 700;   // jeda sebelum auto-redirect
  const ANDROID_FALLBACK_MS = 2500; // kalau GMALite tidak kebuka -> web

  // ====== DETEKSI DEVICE ======
  const ua = navigator.userAgent || "";
  const isAndroid = /Android/i.test(ua);
  const isIOS = /iPhone|iPad|iPod/i.test(ua);

  // ====== ELEMENT ======
  const statusEl = document.getElementById("status");
  const hintEl = document.getElementById("hint");
  const smartEl = document.getElementById("smart");
  const deepEl  = document.getElementById("deep");
  const openApp = document.getElementById("openApp");
  const openWeb = document.getElementById("openWeb");
  const copyBtn = document.getElementById("copy");

  // Deep link GMALite (Android)
  const deepLink = `gmalite://gmalite-smartweb?weburl=${encodeURIComponent(SMARTLINK)}`;

  smartEl.textContent = SMARTLINK;
  deepEl.textContent = deepLink;
  openApp.href = deepLink;
  openWeb.href = SMARTLINK;

  function setStatus(text, type="ok"){
    const dotClass = type === "warn" ? "dot warn" : "dot";
    statusEl.innerHTML = `<span class="${dotClass}"></span> ${text}`;
  }

  // Copy link
  copyBtn.addEventListener("click", async () => {
    try {
      await navigator.clipboard.writeText(SMARTLINK);
      hintEl.textContent = "Link disalin ✅";
    } catch {
      hintEl.textContent = "Gagal salin (izin browser).";
    }
  });

  // Android: coba buka app, kalau gagal -> web
  function openAndroidWithFallback() {
    setStatus("Android terdeteksi. Mencoba membuka GMALite…");
    hintEl.textContent = "Jika tidak terbuka, akan dialihkan ke browser.";

    let didHide = false;
    const onVis = () => { if (document.visibilityState === "hidden") didHide = true; };
    document.addEventListener("visibilitychange", onVis, { passive:true });

    // coba buka app
    window.location.href = deepLink;

    // fallback
    setTimeout(() => {
      document.removeEventListener("visibilitychange", onVis);
      if (!didHide) {
        setStatus("GMALite tidak terbuka. Membuka via browser…", "warn");
        window.location.href = SMARTLINK;
      } else {
        setStatus("Jika GMALite terbuka, lanjutkan di aplikasi.");
      }
    }, ANDROID_FALLBACK_MS);
  }

  // iOS: langsung web (iOS tidak support gmalite://)
  function openIOSWeb() {
    setStatus("iPhone/iOS terdeteksi. Membuka via browser…", "warn");
    hintEl.textContent = "iOS tidak mendukung deep link GMALite, jadi diarahkan ke web.";
    window.location.href = SMARTLINK;
  }

  // Desktop/others: web
  function openOtherWeb() {
    setStatus("Membuka via browser…");
    window.location.href = SMARTLINK;
  }

  // Auto-run
  setTimeout(() => {
    if (isAndroid) openAndroidWithFallback();
    else if (isIOS) openIOSWeb();
    else openOtherWeb();
  }, AUTO_OPEN_DELAY_MS);

})();
</script>
</body>
</html>
